<h1 align="center">
  <img src="https://otomi.io/img/otomi-logo.svg" width="224px"/><br/>
  Self-hosted PaaS for Kubernetes
</h1>
<p align="center"><b>Deploy your apps fast and safe on any Kubernetes cluster in any cloud</b></p>

## Description

[Otomi](https://github.com/redkubes/otomi-core) brings a full PaaS experience to Kubernetes without any constraints and abstractions on top of the tolls you already love and use. No more reinventing the wheel when building and maintaining your own K8s based (developer) platform.

Otomi offers a complete suite of pre-configured, integrated and automated applications for Kubernetes (like Istio, Knative, Harbor, Prometheus, Argo CD), combined with developer self-service, as a single installable package.

**Core features**

1. Drag and Drop popular open-source apps to create your own preferred suite
2. An advanced ingress architecture. Expose services with just a few clicks
3. Configure network policies for internal ingress and external egress
4. Create Kubernetes Jobs and Cron Jobs without writing any YAML
5. Onboard (development) teams or projects within minutes in a comprehensive multi-tenant setup
6. Make developers self-serving by providing access to predefined automation tasks

**Optional (if the app is activated)**
1. Deploy Knative serverless workloads without writing any YAML
2. Create and manage secrets in HashiCorp Vault and use them in your workloads
3. GitOps with Argo CD out-of-the-box
4. Policy enforcement based on a default set of security policies
5. Full observability based on Prometheus, Grafana, Loki and Alert manager


**Notes:**

- This stack requires a minimum configuration of 4 nodes at the $0.13/hour plan (2.5GB memory/2 vCPUs)
- Otomi is installed with a auto generated CA and uses the public IP of the load

## Software included

| Package               | Application Version   |License                                                                                    |
| ---| ---- | ------------- |
| otomi | [v0.16.3](https://github.com/redkubes/otomi-core/releases/tag/v0.16.3) | [Apache 2.0](https://github.com/redkubes/otomi-core/blob/main/LICENSE) |

## Getting Started

### How to Connect to Your Cluster

Follow these [instructions](https://www.digitalocean.com/docs/kubernetes/how-to/connect-to-cluster/) to connect to your cluster with `kubectl` and `doctl`.

### Confirming that Otomi is Running

First, check if the Otomi installation was successful by running the command below:

```bash
kubectl get job otomi -w
```

The output looks similar to the following:

```text
NAME    COMPLETIONS   DURATION   AGE
otomi   1/1           14m        14m
```
  
Next, check the installer job logs to get the otomi console `url` and `credentials` by running the following command:

```bash
kubectl logs jobs/otomi -n default --tail=7
```

The output looks similar to the following:

```bash
########################################################################################################################################
#
#  To start using Otomi, go to https://otomi.134.209.133.239.nip.io and sign in to the web console
#  with username "otomi-admin" and password "OTzVCbJbvIN1T0LIij4U".
#  Then activate Drone. For more information see: https://otomi.io/docs/installation/activation/
#
########################################################################################################################################
```
  
### Accessing Otomi console

- Sign into the otomi web console `url` using the `credentials` found in the installer job logs.

<!-- <p align="center"><img src="https://github.com/redkubes/marketplace-kubernetes/blob/main/img/otomi-console-login.png/?raw=true" width="100%" align="center" alt="otomi console login"></p> -->

  <img src="./img/otomi-console-login.png" alt="otomi console login" width="1080" height="570" align="center"/>

- Add the auto generated CA to your keychain/credential manager (optional)

<img src="./img/download-ca.png" alt="download ca" width="1080" height="570"/>

```bash
NOTE:
# To prevent you from clicking away lots of security warnings in your browser, you can add the generated CA to your keychain/credential manager:
# Since we install Otomi without proving a custom CA or using LetsEncrypt, the installer generated a CA which is not trusted on your local machine.
```

- In the left menu of the console, click on "Download CA"
- Double click the downloaded CA.crt or add the CA to your keychain on your mac using the following command:
  
  ```bash
  # On Mac
  sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt
  # Restart the browser or open it in private mode
  ```  

  ```powershell
  # On Windows(PowerShell - Run as Administrator)
  # Use certutil:
  certutil.exe -addstore root <downloaded cert path>
  # Or 
  Import-Certificate -FilePath "<downloaded cert path>" -CertStoreLocation Cert:\LocalMachine\Root
  # Restart the browser or open it in private mode
  ```

### Post-install configurations

- In the side menu of Otomi Console under `Platform`, select `Apps` and click on the **Drone** app
- Click on the `play` button in the top right. A new tab will open for Drone and click `CONTINUE`
- Sign in locally with as `otomi-admin` and the `password` provided in the logs of the installer job.
- Click on `Authorize Application`
- Click on `SUBMIT` on the Complete your Drone Registration page. You don't need to fill in your Email, Full Name or Company Name if you don't want to
- Click on the `otomi/values` repository
- Click on `+ ACTIVATE REPOSITORY`

<img src="./img/otomi-drone-activate.gif" alt="activate drone" width="1080" height="570"/>

Now head to the [workshops](https://github.com/redkubes/workshops) to explore Otomi through a series of hands-on labs. 
### Additional Resources

- [Otomi Documentation](https://otomi.io/docs/installation/)
- [Otomi Slack](https://otomi.slack.com/ssb/redirect#/shared-invite/email)
